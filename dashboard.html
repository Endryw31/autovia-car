<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard | Autovia Car</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="shortcut icon" href="img/configuracao.png" type="image/x-icon">
    <link rel="stylesheet" href="css/dashboard.css">
</head>
<body>

<!-- ================= HEADER ================= -->
<header class="app-header">
    <div class="logo-area">
        <img src="img/image-removebg-preview.png" alt="Logo Autovia" class="logo">
        <h1>AUTOVIA - CAR</h1>
    </div>

    <nav class="nav-links d-none d-lg-flex">
        <a href="dashboard.html" class="active">Dashboard</a>
        <a href="clientes.html">Clientes</a>
        <a href="veiculos.html">Ve√≠culos</a>
        <a href="vendas.html">Vendas</a>
        <a href="login.html" class="logout">Sair</a>
    </nav>

    <div class="header-actions">
        <button id="themeToggle" class="btn-theme"><i class="bi bi-moon-stars-fill"></i></button>
        <button id="menuToggle" class="btn-menu d-lg-none"><i class="bi bi-list"></i></button>
    </div>
</header>

<!-- SIDEBAR MOBILE -->
<nav class="sidebar" id="sidebarMenu">
    <a href="dashboard.html" class="active">Dashboard</a>
    <a href="clientes.html">Clientes</a>
    <a href="veiculos.html">Ve√≠culos</a>
    <a href="vendas.html">Vendas</a>
    <a href="login.html" class="logout">Sair</a>
</nav>

<!-- ================= Mensagem Din√¢mica ================= -->
<div id="modalBoasVindas" class="modal-premium-overlay">
    <div class="modal-premium-box">
        <div class="modal-icone">üöó</div>

        <h2 id="tituloSaudacao" class="modal-titulo">Bem-vindo!</h2>
        <p id="mensagemDinamica" class="modal-texto">Carregando...</p>

        <button class="modal-btn" onclick="fecharModalPremium()">Entrar no Dashboard</button>
    </div>
</div>

<!-- ================= CONTE√öDO PRINCIPAL ================= -->
<main class="container-fluid conteudo">

    <h2 class="fw-bold mb-4">Vis√£o Geral</h2>

    <!-- KPIs -->
    <div class="row row-cols-1 row-cols-md-2 row-cols-xl-4 g-3 mb-4">
        <div class="col">
            <div class="kpi-card"><h6>Total de Ve√≠culos</h6><div class="fs-2 fw-bold" id="kpiTotalVeiculos">‚Äî</div></div>
        </div>
        <div class="col">
            <div class="kpi-card"><h6>Dispon√≠veis</h6><div class="fs-2 fw-bold" id="kpiDisponiveis">‚Äî</div></div>
        </div>
        <div class="col">
            <div class="kpi-card"><h6>Clientes Registrados</h6><div class="fs-2 fw-bold" id="kpiClientes">‚Äî</div></div>
        </div>
        <div class="col">
            <div class="kpi-card"><h6>Ve√≠culos Vendidos</h6><div class="fs-2 fw-bold" id="kpiVendidos">‚Äî</div></div>
        </div>
    </div>

    <div class="row g-4">

        <!-- Gr√°ficos -->
        <div class="col-lg-6">
            <div class="card card-body shadow-sm">
                <h5>Distribui√ß√£o por Marca</h5>
                <canvas id="graficoMarcas"></canvas>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card card-body shadow-sm">
                <h5>Status dos Ve√≠culos</h5>
                <canvas id="graficoStatus"></canvas>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card card-body shadow-sm">
                <h5>Origem dos Clientes</h5>
                <canvas id="graficoCidades"></canvas>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card card-body shadow-sm">
                <h5>Evolu√ß√£o de Vendas</h5>
                <canvas id="graficoLinha"></canvas>
            </div>
        </div>

        <!-- TABELA: √öltimos Ve√≠culos -->
        <div class="col-lg-6">
            <div class="card card-body shadow-sm">
                <h5>√öltimos Ve√≠culos</h5>
                <table class="table table-sm table-hover">
                    <thead><tr><th>Placa</th><th>Marca</th><th>Modelo</th></tr></thead>
                    <tbody id="tabelaUltimosVeiculos"></tbody>
                </table>
            </div>
        </div>

        <!-- TABELA: √öltimos Clientes -->
        <div class="col-lg-6">
            <div class="card card-body shadow-sm">
                <h5>√öltimos Clientes</h5>
                <table class="table table-sm table-hover">
                    <thead><tr><th>Nome</th><th>Cidade</th></tr></thead>
                    <tbody id="tabelaUltimosClientes"></tbody>
                </table>
            </div>
        </div>

    </div>

</main>
<!-- MODAL DE CONFIRMA√á√ÉO DE SA√çDA -->
<div id="modalLogout" class="modal-logout-overlay">
  <div class="modal-logout">
    <h2>Deseja realmente sair?</h2>
    <p>Voc√™ ser√° redirecionado para a tela de login.</p>

    <div class="logout-actions">
      <button id="logoutConfirm" class="btn btn-danger w-100 mt-2">Sim, sair</button>
      <button id="logoutCancel" class="btn btn-secondary w-100 mt-2">Cancelar</button>
    </div>
  </div>
</div>
<script>
// ============================================
// BLOQUEIO DO LINK "SAIR" ‚Äì CAPTURING MODE
// (impede fade-out e redirecionamento autom√°tico)
// ============================================
document.addEventListener("click", function (e) {
    const isLogout = e.target.closest(".logout");

    if (isLogout) {
        e.preventDefault();  // impede a navega√ß√£o imediata
        // Importante: N√ÉO usar stopImmediatePropagation,
        // pois o modal usa bubbling e precisa receber o clique.
    }
}, true);


// ============================================
// RESTANTE DO SCRIPT
// ============================================
document.addEventListener("DOMContentLoaded", () => {

    // fade IN
    requestAnimationFrame(() => {
        document.body.classList.add("page-loaded");
    });

    // fade OUT suave (IGNORA o bot√£o Sair)
    document.querySelectorAll("a").forEach(link => {
        const href = link.getAttribute("href");

        if (!href || href.startsWith("#") || href.startsWith("javascript")) return;

        // IGNORAR o bot√£o sair
        if (link.classList.contains("logout")) return;

        link.addEventListener("click", (e) => {
            e.preventDefault();

            document.body.classList.remove("page-loaded");
            document.body.classList.add("page-exit-active");

            setTimeout(() => {
                window.location = href;
            }, 300);
        });
    });


    // ============================================
    // MODAL DE CONFIRMA√á√ÉO DE LOGOUT
    // ============================================
    const modalLogout = document.getElementById("modalLogout");
    const logoutLinks = document.querySelectorAll(".logout");
    const logoutConfirm = document.getElementById("logoutConfirm");
    const logoutCancel = document.getElementById("logoutCancel");

    // Abrir modal ao clicar no bot√£o sair
    logoutLinks.forEach(link => {
        link.addEventListener("click", (e) => {
            e.preventDefault(); 
            modalLogout.classList.add("ativo");
        });
    });

    // Cancelar logout
    logoutCancel?.addEventListener("click", () => {
        modalLogout.classList.remove("ativo");
    });

    // Confirmar logout
    logoutConfirm?.addEventListener("click", () => {
        window.location.href = "login.html";
    });

});
</script>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="js/dashboard.js"></script>

</body>
</html>
